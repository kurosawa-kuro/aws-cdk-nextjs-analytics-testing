# Public targets
.PHONY: first-deploy reset-deploy destroy

# Initial deployment
first-deploy: _validate-env _install-deps
	@echo "ğŸš€ Starting first deployment..."
	cdk deploy --require-approval never
	@echo "âœ… First deployment completed!"

# Reset and redeploy
reset-deploy: destroy first-deploy
	@echo "ğŸ”„ Reset deployment completed!"

# Destroy stack
destroy:
	@echo "ğŸ”¥ Destroying stack..."
	cdk destroy --force
	@echo "ğŸ—‘ï¸ Stack destroyed!"

# Private targets
.PHONY: _validate-env _install-deps

# Validate environment
_validate-env:
	@echo "ğŸ” Validating environment..."
	node -v
	pnpm -v
	psql --version

# Install dependencies
_install-deps:
	@echo "ğŸ“¦ Installing dependencies..."
	pnpm install
